// Generated by CoffeeScript 2.5.1
//! ========================================
//! Version
var Discord, formattedTime, handler, relative;

Discord = require('discord.js');

relative = require(`${__dirname}/../helpers/relative`);

formattedTime = function(secs) {
  var h, m, r, s;
  h = ~~(secs / 3600);
  m = ~~((secs % 3600) / 60);
  s = ~~(secs % 60);
  r = "";
  r += `${h}:` + (m < 10 ? '0' : '');
  r += `${m}:` + (s < 10 ? '0' : '');
  r += s;
  return r;
};

handler = function(msg, match, H) {
  var chosenBlob, embed;
  chosenBlob = H.config.about.blobs.choose();
  if (Array.isArray(chosenBlob)) {
    chosenBlob = chosenBlob.choose();
  }
  embed = new Discord.RichEmbed().setColor('#448aff').setTitle(`Haruka ${H.version}`).addField("Uptime", `${formattedTime(H.client.uptime / 1000)} â€¢ Started ${relative(new Date() - H.client.uptime).toLowerCase()}`).addField("Function counts", `${H.functions.length} functions, ${H.specials.length} specials.`).addField("Functions", `${H.functions.map(function(f) {
    return f.name;
  }).join(', ')}`).addField("Specials", `${H.specials.map(function(f) {
    return f.name;
  }).join(', ')}`).addField("Server count", `In ${H.client.guilds.size} servers`).setFooter(`${H.config.name}@${H.version}`).setTimestamp(H.client.readyAt);
  return msg.channel.send(embed);
};

module.exports = {
  name: "Version",
  regex: /^(version|v|stats)(\s+|$)/i,
  handler: handler,
  help: {
    hidden: true,
    long: `\`\`\`asciidoc
=== Help for Version ===
*Aliases*: version, v, stats
-h version  :: Prints out technical information about Haruka.
\`\`\``
  }
};
